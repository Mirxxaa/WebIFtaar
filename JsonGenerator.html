<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ramadan Menu Â· JSON Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
:root{
  --gold:#D4AF37;--gold2:#f0d070;--dark:#0E0E18;--panel:#16161F;
  --border:#2a2a3a;--text:#EAE6D8;--muted:#666070;--green:#4caf7d;--red:#e05252;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--dark);color:var(--text);font-family:'Cormorant Garamond',serif;min-height:100vh}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 40% at 50% 0%,rgba(212,175,55,.1) 0%,transparent 65%);pointer-events:none}

.wrap{position:relative;max-width:900px;margin:0 auto;padding:40px 20px 80px}

/* Header */
header{text-align:center;margin-bottom:48px}
.moon{font-size:2.4rem;display:block;margin-bottom:14px;animation:float 4s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
header h1{font-size:clamp(2rem,5vw,3rem);font-weight:300;letter-spacing:.14em;text-transform:uppercase;
  background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
header p{margin-top:8px;font-family:'DM Mono',monospace;font-size:.75rem;color:var(--muted);letter-spacing:.08em}

/* Steps */
.steps{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
@media(max-width:620px){.steps{grid-template-columns:1fr}}

.step-card{background:var(--panel);border:1px solid var(--border);border-radius:3px;padding:28px 24px;position:relative;overflow:hidden}
.step-card::before{content:attr(data-n);position:absolute;top:-10px;right:14px;font-size:5rem;font-weight:600;color:rgba(212,175,55,.06);font-family:'Cormorant Garamond',serif;line-height:1;pointer-events:none}
.step-label{font-family:'DM Mono',monospace;font-size:.6rem;letter-spacing:.22em;text-transform:uppercase;color:var(--gold);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.step-label::after{content:'';flex:1;height:1px;background:var(--border)}
.step-title{font-size:1.25rem;font-weight:400;margin-bottom:8px;letter-spacing:.03em}
.step-desc{font-family:'DM Mono',monospace;font-size:.7rem;color:var(--muted);line-height:1.7;margin-bottom:20px}

/* Download button */
.btn-download{
  display:inline-flex;align-items:center;gap:10px;width:100%;justify-content:center;
  padding:13px 20px;
  background:linear-gradient(135deg,var(--gold) 0%,#a8832a 100%);
  color:#0E0E18;font-family:'DM Mono',monospace;font-size:.75rem;font-weight:500;
  letter-spacing:.12em;text-transform:uppercase;border:none;border-radius:2px;
  cursor:pointer;transition:opacity .2s,transform .15s;text-decoration:none
}
.btn-download:hover{opacity:.88;transform:translateY(-1px)}
.btn-download:active{transform:translateY(0)}

/* Upload zone */
.upload-zone{
  border:2px dashed var(--border);border-radius:3px;padding:28px 20px;text-align:center;
  cursor:pointer;transition:border-color .25s,background .25s;position:relative
}
.upload-zone:hover,.upload-zone.drag{border-color:var(--gold);background:rgba(212,175,55,.04)}
.upload-zone.has-file{border-color:var(--green);border-style:solid}
.upload-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-icon{font-size:2rem;display:block;margin-bottom:8px;transition:transform .2s}
.upload-zone:hover .upload-icon,.upload-zone.drag .upload-icon{transform:translateY(-3px)}
.upload-zone.has-file .upload-icon{filter:grayscale(0)}
.upload-hint{font-family:'DM Mono',monospace;font-size:.68rem;color:var(--muted);margin-top:6px}
.upload-name{font-family:'DM Mono',monospace;font-size:.72rem;color:var(--green);margin-top:8px;word-break:break-all}

/* Config row */
.config-row{background:var(--panel);border:1px solid var(--border);border-radius:3px;padding:20px 24px;margin-bottom:20px;display:flex;flex-wrap:wrap;gap:20px;align-items:flex-end}
.field{display:flex;flex-direction:column;gap:7px}
.field label{font-family:'DM Mono',monospace;font-size:.62rem;letter-spacing:.18em;text-transform:uppercase;color:var(--muted)}
.field input{background:#0a0a10;border:1px solid var(--border);color:var(--text);font-family:'DM Mono',monospace;font-size:.95rem;padding:9px 14px;border-radius:2px;width:100px;outline:none;transition:border-color .2s}
.field input:focus{border-color:var(--gold)}

.btn-parse{
  margin-left:auto;padding:11px 36px;
  background:linear-gradient(135deg,var(--gold) 0%,#a8832a 100%);
  color:#0E0E18;font-family:'DM Mono',monospace;font-size:.78rem;font-weight:500;
  letter-spacing:.15em;text-transform:uppercase;border:none;border-radius:2px;
  cursor:pointer;transition:opacity .2s,transform .15s
}
.btn-parse:hover{opacity:.88;transform:translateY(-1px)}
.btn-parse:disabled{opacity:.35;cursor:not-allowed;transform:none}

/* Alert */
.alert{display:none;padding:14px 18px;border-radius:2px;font-family:'DM Mono',monospace;font-size:.76rem;line-height:1.7;margin-bottom:18px;white-space:pre-wrap}
.alert.err{background:rgba(224,82,82,.1);border:1px solid var(--red);color:#f09090;display:block}
.alert.ok{background:rgba(76,175,125,.1);border:1px solid var(--green);color:#80d4a8;display:block}

/* Output */
.output-wrap{background:var(--panel);border:1px solid var(--border);border-radius:3px;overflow:hidden}
.output-bar{display:flex;justify-content:space-between;align-items:center;background:#0a0a10;padding:11px 18px;border-bottom:1px solid var(--border)}
.output-bar span{font-family:'DM Mono',monospace;font-size:.62rem;letter-spacing:.18em;text-transform:uppercase;color:var(--muted)}
.btn-copy{background:none;border:1px solid var(--border);color:var(--gold);font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.12em;text-transform:uppercase;padding:6px 14px;border-radius:2px;cursor:pointer;transition:all .2s}
.btn-copy:hover{background:var(--gold);color:#0E0E18}
.btn-copy.done{background:var(--green);border-color:var(--green);color:#0E0E18}
textarea#out{width:100%;min-height:380px;background:#080810;border:none;color:#7dd3b0;font-family:'DM Mono',monospace;font-size:.78rem;line-height:1.7;padding:20px;resize:vertical;outline:none}

/* Stats */
.stats{display:none;flex-wrap:wrap;gap:28px;padding:16px 24px;border-top:1px solid var(--border)}
.stats.show{display:flex}
.stat{font-family:'DM Mono',monospace;font-size:.7rem;color:var(--muted)}
.stat strong{display:block;font-size:1.3rem;color:var(--gold);font-weight:500}

/* Spinner */
.spin{display:inline-block;width:13px;height:13px;border:2px solid rgba(0,0,0,.2);border-top-color:#0E0E18;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Divider */
.or{display:flex;align-items:center;gap:14px;color:var(--muted);font-family:'DM Mono',monospace;font-size:.62rem;letter-spacing:.15em;margin:4px 0}
.or::before,.or::after{content:'';flex:1;height:1px;background:var(--border)}
</style>
</head>
<body>
<div class="wrap">

<header>
  <span class="moon">ðŸŒ™</span>
  <h1>Ramadan Menu Â· JSON</h1>
  <p>Download template â†’ Fill data â†’ Upload â†’ Get JSON</p>
</header>

<!-- STEP 1 + STEP 2 side by side -->
<div class="steps">

  <!-- Step 1 -->
  <div class="step-card" data-n="1">
    <div class="step-label">Step 1</div>
    <div class="step-title">Download Template</div>
    <div class="step-desc">
      Get the pre-built Excel file.<br>
      It has all 6 categories pre-filled<br>
      for 8 days â€” just paste your data.
    </div>
    <button class="btn-download" onclick="downloadTemplate()">
      <span>â¬‡</span> Download Template.xlsx
    </button>
  </div>

  <!-- Step 2 -->
  <div class="step-card" data-n="2">
    <div class="step-label">Step 2</div>
    <div class="step-title">Fill &amp; Upload</div>
    <div class="step-desc">
      Fill in English &amp; Arabic items<br>
      for each day. Save the file,<br>
      then upload it here.
    </div>
    <div class="upload-zone" id="dropZone">
      <input type="file" id="fileInput" accept=".xlsx,.xls"/>
      <span class="upload-icon" id="upIcon">ðŸ“‚</span>
      <div style="font-size:1rem;font-weight:500">Drop file or click to browse</div>
      <div class="upload-hint">.xlsx / .xls accepted</div>
      <div class="upload-name" id="upName"></div>
    </div>
  </div>

</div>

<!-- Config + Parse -->
<div class="config-row">
  <div class="field">
    <label>Starting Day Number</label>
    <input type="number" id="startDay" value="1" min="1" max="30"/>
  </div>
  <div style="font-family:'DM Mono',monospace;font-size:.7rem;color:var(--muted);line-height:1.8;padding-bottom:2px">
    First column = Day N<br>
    <span style="color:var(--gold);font-size:.65rem">e.g. set 8 if week starts on Day 8</span>
  </div>
  <button class="btn-parse" id="parseBtn" onclick="parseFile()">Generate JSON</button>
</div>

<!-- Alert -->
<div class="alert" id="alertBox"></div>

<!-- Output -->
<div class="output-wrap">
  <div class="output-bar">
    <span>JSON Output</span>
    <button class="btn-copy" id="copyBtn" onclick="copyJSON()">Copy JSON</button>
  </div>
  <textarea id="out" readonly placeholder="// Upload your filled template and click Generate JSON â€¦"></textarea>
  <div class="stats" id="statsBar">
    <div class="stat"><strong id="sDays">â€”</strong>Days</div>
    <div class="stat"><strong id="sCats">â€”</strong>Categories</div>
    <div class="stat"><strong id="sItems">â€”</strong>Items</div>
    <div class="stat"><strong id="sLines">â€”</strong>JSON Lines</div>
  </div>
</div>

</div><!-- /wrap -->

<script>
// â”€â”€â”€ EMBEDDED TEMPLATE (base64) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TEMPLATE_B64 = "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";

// â”€â”€â”€ Category definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATS = [
  { en:"Iftar",       ar:"Ø§Ù„Ø¥ÙØ·Ø§Ø±",         enKeys:["iftar"],               arKeys:["Ø§ÙØ·Ø§Ø±","Ø§Ù„Ø¥ÙØ·Ø§Ø±","Ø§Ù„Ø§ÙØ·Ø§Ø±","Ø¥ÙØ·Ø§Ø±"] },
  { en:"Salads",      ar:"Ø§Ù„Ø³Ù„Ø·Ø§Øª",         enKeys:["salads","salads "],    arKeys:["Ø§Ù„Ø³Ù„Ø·Ø§Øª"," Ø§Ù„Ø³Ù„Ø·Ø§Øª","Ø³Ù„Ø·Ø§Øª"] },
  { en:"Soup",        ar:"Ø§Ù„Ø´ÙˆØ±Ø¨Ø§Øª",        enKeys:["soup","soups"],        arKeys:["Ø§Ù„Ø´ÙˆØ±Ø¨Ø§Øª","Ø§Ù„Ø´ÙˆØ±Ø¨Ø©","Ø´ÙˆØ±Ø¨Ø§Øª"] },
  { en:"Starters",    ar:"Ø§Ù„Ù…Ù‚Ø¨Ù„Ø§Øª",        enKeys:["starters","starter"],  arKeys:["Ù…Ù‚Ø¨Ù„Ø§Øª","Ø§Ù„Ù…Ù‚Ø¨Ù„Ø§Øª"] },
  { en:"Main Course", ar:"Ø§Ù„Ø·Ø¨Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",  enKeys:["main course"],         arKeys:["Ø§Ù„Ø·Ø¨Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ","Ø·Ø¨Ù‚ Ø±Ø¦ÙŠØ³ÙŠ"] },
  { en:"Desserts",    ar:"Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª",        enKeys:["desserts","dessert"],  arKeys:["Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª","Ø­Ù„ÙˆÙŠØ§Øª"] },
];

// Build lookup sets
const ALL_EN = new Set(); const ALL_AR = new Set();
CATS.forEach(c=>{ c.enKeys.forEach(k=>ALL_EN.add(cl(k))); c.arKeys.forEach(k=>ALL_AR.add(cl(k))); });

function cl(s){
  if(!s && s!==0) return '';
  return String(s).replace(/\u00a0/g,' ').replace(/[Ø¥Ø£Ø¢Ù±]/g,'Ø§').trim().toLowerCase();
}

// â”€â”€â”€ Download template â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadTemplate(){
  const bytes = Uint8Array.from(atob(TEMPLATE_B64), c=>c.charCodeAt(0));
  const blob  = new Blob([bytes],{type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='Ramadan_Menu_Template.xlsx'; a.click();
}

// â”€â”€â”€ File upload UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');

fileInput.addEventListener('change',()=>{
  if(fileInput.files[0]) setFile(fileInput.files[0]);
});
dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.classList.add('drag')});
dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('drag'));
dropZone.addEventListener('drop',e=>{
  e.preventDefault(); dropZone.classList.remove('drag');
  if(e.dataTransfer.files[0]) { fileInput.files=e.dataTransfer.files; setFile(e.dataTransfer.files[0]); }
});
function setFile(f){
  dropZone.classList.add('has-file');
  document.getElementById('upIcon').textContent='âœ…';
  document.getElementById('upName').textContent=f.name;
}

// â”€â”€â”€ Parse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function parseFile(){
  const btn=document.getElementById('parseBtn');
  const alertBox=document.getElementById('alertBox');
  const out=document.getElementById('out');
  alertBox.className='alert'; alertBox.textContent='';
  out.value=''; document.getElementById('statsBar').classList.remove('show');

  const file=fileInput.files[0];
  if(!file){ showAlert('Please upload your filled template first.','err'); return; }

  const startDay=parseInt(document.getElementById('startDay').value)||1;
  btn.disabled=true; btn.innerHTML='<span class="spin"></span>Parsingâ€¦';

  try{
    const buf=await file.arrayBuffer();
    const wb=XLSX.read(buf,{type:'array'});
    const ws=wb.Sheets[wb.SheetNames[0]];
    const matrix=XLSX.utils.sheet_to_json(ws,{header:1,defval:null});

    // Detect structure: find header row (row with "Day 1" or "Day")
    // Template layout: Row1=Day headers(merged), Row2=EN/AR subheaders, Row3+=data
    // Col A = label, Col B=Day1-EN, Col C=Day1-AR, Col D=Day2-EN ... etc
    // So even columns (B,D,F...)= EN, odd columns (C,E,G...)= AR
    // ColIndex: EN for day d = 1 + (d-1)*2, AR = 2 + (d-1)*2  (0-based)

    // Find how many day-columns exist by scanning row 0 for "Day" headers
    const row0 = matrix[0] || [];
    let numDays=0;
    for(let c=1;c<row0.length;c+=2){
      const v=String(row0[c]||'').trim();
      if(/^day\s*\d+/i.test(v)) numDays++;
      else if(v==='' && numDays>0) break;
    }
    if(numDays===0){
      // fallback: count non-empty column pairs from col B onward
      numDays = Math.floor((matrix[0]||[]).filter((_,i)=>i>0).filter(v=>v!==null).length/2);
      if(numDays===0) throw new Error('Could not detect Day columns. Make sure you are uploading the correct template.');
    }

    const results=[];
    let totalItems=0;

    for(let d=0;d<numDays;d++){
      const enColIdx = 1 + d*2;  // 0-based
      const arColIdx = 2 + d*2;
      const dayNum   = startDay + d;
      const dayEntry = {day:dayNum, categories:[]};

      // Scan rows for category headers and items
      // Category detected when EN col matches a known category key
      let currentCat=null; let enItems=[]; let arItems=[];

      const flushCat=()=>{
        if(currentCat===null) return;
        if(enItems.length!==arItems.length){
          throw new Error(`Day ${dayNum} â€º "${CATS[currentCat].en}": English has ${enItems.length} item(s) but Arabic has ${arItems.length} item(s).\nCheck your template for empty cells.`);
        }
        dayEntry.categories.push({
          title:{en:CATS[currentCat].en, ar:CATS[currentCat].ar},
          items:enItems.map((e,i)=>({en:e.trim(),ar:arItems[i].trim()}))
        });
        totalItems+=enItems.length;
        currentCat=null; enItems=[]; arItems=[];
      };

      for(let r=0;r<matrix.length;r++){
        const row=matrix[r]||[];
        const enVal=row[enColIdx]; const arVal=row[arColIdx];
        const enStr=String(enVal||'').trim(); const arStr=String(arVal||'').trim();
        if(!enStr && !arStr) continue;

        // Check if EN cell is a category header
        const enCleaned=cl(enStr);
        const catIdx=CATS.findIndex(c=>c.enKeys.some(k=>cl(k)===enCleaned));
        if(catIdx!==-1){
          flushCat();
          currentCat=catIdx;
          continue;
        }

        // Otherwise it's a data item â€” only collect if inside a category and both values present
        if(currentCat!==null && enStr && arStr){
          enItems.push(enStr);
          arItems.push(arStr);
        }
      }
      flushCat();

      if(dayEntry.categories.length>0) results.push(dayEntry);
    }

    if(results.length===0) throw new Error('No data found. Make sure you filled in the template and saved it before uploading.');

    const json=JSON.stringify(results,null,2);
    out.value=json;

    const lines=json.split('\n').length;
    document.getElementById('sDays').textContent=results.length;
    document.getElementById('sCats').textContent=results.reduce((s,d)=>s+d.categories.length,0);
    document.getElementById('sItems').textContent=totalItems;
    document.getElementById('sLines').textContent=lines.toLocaleString();
    document.getElementById('statsBar').classList.add('show');

    showAlert(`âœ“ Successfully parsed ${results.length} day(s) with ${totalItems} menu items.`,'ok');
  }catch(e){
    showAlert(e.message,'err');
    console.error(e);
  }finally{
    btn.disabled=false; btn.innerHTML='Generate JSON';
  }
}

function showAlert(msg,type){ const b=document.getElementById('alertBox'); b.className='alert '+type; b.textContent=msg; }

function copyJSON(){
  const t=document.getElementById('out'); if(!t.value) return;
  navigator.clipboard.writeText(t.value).then(()=>{
    const b=document.getElementById('copyBtn'); b.classList.add('done'); b.textContent='Copied âœ“';
    setTimeout(()=>{ b.classList.remove('done'); b.textContent='Copy JSON'; },2200);
  });
}
</script>
</body>
</html>